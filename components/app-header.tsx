"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { useTheme } from "next-themes";
import { useState, useEffect } from "react";
import { Sun, Moon, Home, Menu, X, Droplets, Github } from "lucide-react";

interface AppHeaderProps {
  title?: string;
  githubUrl?: string;
}

export function AppHeader({
  title = "EPANET Utilities",
  githubUrl = "https://github.com/modelcreate/epanet-utilities",
}: AppHeaderProps) {
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const pathname = usePathname();
  const isHomePage = pathname === "/";

  // Dark mode switch logic
  const { setTheme, resolvedTheme } = useTheme();
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
  }, []);

  return (
    <header className="col-span-2 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-b border-gray-300 dark:border-slate-700 z-50 relative">
      <div className={`${isHomePage ? "max-w-5xl container mx-auto" : ""} px-4`}>
        <div className="flex items-center justify-between h-14">
          <div className="flex items-center">
            <Link href="/" className="flex gap-1 items-center text-gray-900 dark:text-gray-300 hover:text-purple-500">
              <LogoIconAndWordmarkIcon size={98} />
              <span className="text-base font-semibold">
                Utilities
              </span>
            </Link>
          </div>

          {/* Desktop navigation */}
          <div className="hidden md:flex items-center space-x-4">
            {/* Dark mode toggle button */}
            {mounted && (
              <button
                onClick={() =>
                  setTheme(resolvedTheme === "dark" ? "light" : "dark")
                }
                className="p-2 rounded-md text-gray-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
              >
                {resolvedTheme === "dark" ? (
                  <Sun className="h-5 w-5" />
                ) : (
                  <Moon className="h-5 w-5" />
                )}
              </button>
            )}
          </div>

          {/* Mobile menu button */}
          <div className="md:hidden">
            <button
              type="button"
              className="p-1.5 rounded-md text-gray-600 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors"
              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
            >
              {mobileMenuOpen ? (
                <X className="h-5 w-5" aria-hidden="true" />
              ) : (
                <Menu className="h-5 w-5" aria-hidden="true" />
              )}
            </button>
          </div>
        </div>
      </div>

      {/* Mobile menu */}
      {mobileMenuOpen && (
        <div className="md:hidden bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 py-2 absolute w-full shadow-md">
          <div className="container mx-auto px-4 space-y-1">
            {/* Dark mode toggle for mobile */}
            {mounted && (
              <button
                onClick={() =>
                  setTheme(resolvedTheme === "dark" ? "light" : "dark")
                }
                className="flex items-center text-sm text-gray-600 dark:text-slate-300 hover:text-gray-900 dark:hover:text-white p-3 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors w-full"
              >
                {resolvedTheme === "dark" ? (
                  <>
                    <Sun className="h-4 w-4 mr-3" />
                    Light Mode
                  </>
                ) : (
                  <>
                    <Moon className="h-4 w-4 mr-3" />
                    Dark Mode
                  </>
                )}
              </button>
            )}
          </div>
        </div>
      )}
    </header>
  );
}

export const LogoIconAndWordmarkIcon: React.FC<{ size: number, negative?: boolean }> = ({
  size, negative
}) => {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlSpace="preserve"
      viewBox="0 0 98 26"
      style={{
        fillRule: "evenodd",
        clipRule: "evenodd",
        strokeLinejoin: "round",
        strokeMiterlimit: 2,
      }}
      width={size}
    >
      <path d="M0 0h98v26H0z" style={{ fill: "none" }} />
      <clipPath id="a">
        <path d="M0 0h98v26H0z" />
      </clipPath>
      <g clip-path="url(#a)">
        <path
          d="M31.094 18.566c-.844 0-1.572-.187-2.184-.562a3.733 3.733 0 0 1-1.414-1.57c-.331-.672-.496-1.456-.496-2.352 0-.896.161-1.685.484-2.367.323-.682.78-1.216 1.371-1.602.592-.385 1.283-.578 2.075-.578.463 0 .92.077 1.371.231.45.153.859.401 1.226.742.368.341.66.79.879 1.347.219.558.328 1.24.328 2.047v.586h-6.781v-1.187h6.024l-.657.437c0-.573-.09-1.082-.269-1.527a2.32 2.32 0 0 0-.801-1.047c-.354-.253-.794-.379-1.32-.379s-.977.129-1.352.387a2.523 2.523 0 0 0-.859 1.008 3.048 3.048 0 0 0-.297 1.332v.789c0 .646.112 1.194.336 1.644.224.451.538.792.941 1.024.404.232.871.347 1.403.347.343 0 .656-.049.937-.148.281-.099.523-.249.727-.449.203-.201.359-.449.468-.746l1.36.375a2.86 2.86 0 0 1-.688 1.156 3.344 3.344 0 0 1-1.199.781c-.477.188-1.014.281-1.613.281ZM36.75 21.645v-12h1.359v1.398h.157c.099-.156.237-.353.414-.59s.432-.449.765-.637c.334-.187.784-.281 1.352-.281.729 0 1.371.182 1.926.547.554.365.989.884 1.304 1.559.315.674.473 1.472.473 2.394 0 .927-.156 1.729-.469 2.406-.312.677-.746 1.201-1.301 1.571-.554.37-1.196.554-1.925.554-.552 0-.998-.095-1.336-.285-.339-.19-.599-.406-.782-.648a7.957 7.957 0 0 1-.421-.606h-.11v4.618H36.75Zm3.844-4.336c.547 0 1.004-.148 1.371-.442.367-.294.643-.69.828-1.187a4.735 4.735 0 0 0 .277-1.66c0-.605-.091-1.15-.273-1.637-.182-.487-.457-.874-.824-1.16-.368-.287-.827-.43-1.379-.43-.537 0-.987.135-1.352.406-.364.271-.639.647-.824 1.129-.185.482-.277 1.046-.277 1.692 0 .645.093 1.216.281 1.71.187.495.465.882.832 1.161.367.278.814.418 1.34.418ZM49.148 18.582a3.54 3.54 0 0 1-1.503-.312 2.539 2.539 0 0 1-1.075-.915c-.265-.401-.398-.888-.398-1.46 0-.5.099-.907.297-1.219.198-.313.462-.559.793-.739.33-.179.696-.313 1.097-.402.401-.088.805-.159 1.211-.211.521-.067.946-.12 1.274-.156.328-.036.571-.099.73-.188.159-.088.238-.239.238-.453v-.047c0-.364-.067-.673-.203-.925a1.353 1.353 0 0 0-.609-.582c-.271-.136-.609-.203-1.016-.203-.416 0-.773.065-1.07.195a2.193 2.193 0 0 0-1.141 1.086l-1.351-.446c.224-.531.526-.946.906-1.246.38-.299.8-.511 1.258-.636a5.146 5.146 0 0 1 1.359-.188c.292 0 .624.035.996.106.373.07.732.209 1.079.418.346.208.632.517.859.925.226.409.34.955.34 1.637v5.758h-1.383v-1.188h-.094a2.369 2.369 0 0 1-.476.629 2.656 2.656 0 0 1-.852.543c-.349.146-.771.219-1.266.219Zm.243-1.242c.52 0 .961-.102 1.32-.305.359-.203.633-.467.82-.793.188-.325.281-.665.281-1.019v-1.211c-.057.067-.182.129-.375.183a6.143 6.143 0 0 1-.66.145 15.21 15.21 0 0 1-.718.105l-.551.067a4.556 4.556 0 0 0-.949.215c-.295.101-.53.25-.707.445-.178.195-.266.46-.266.793 0 .302.078.555.234.758.157.203.37.356.641.461.271.104.581.156.93.156ZM57.094 13.145v5.234h-1.407V9.645h1.352l.008 2.117h-.195c.265-.808.644-1.38 1.136-1.719.492-.339 1.069-.508 1.731-.508.588 0 1.104.121 1.547.363.442.243.787.607 1.035 1.094.247.487.371 1.1.371 1.84v5.547h-1.406v-5.43c0-.672-.176-1.198-.528-1.578-.351-.38-.832-.57-1.441-.57-.417 0-.792.091-1.125.273a1.979 1.979 0 0 0-.789.797c-.193.349-.289.774-.289 1.274ZM68.812 18.566c-.843 0-1.571-.187-2.183-.562a3.733 3.733 0 0 1-1.414-1.57c-.331-.672-.496-1.456-.496-2.352 0-.896.161-1.685.484-2.367.323-.682.78-1.216 1.371-1.602.591-.385 1.283-.578 2.074-.578.464 0 .921.077 1.372.231.45.153.859.401 1.226.742.367.341.66.79.879 1.347.219.558.328 1.24.328 2.047v.586h-6.781v-1.187h6.023l-.656.437c0-.573-.09-1.082-.269-1.527a2.32 2.32 0 0 0-.801-1.047c-.354-.253-.795-.379-1.321-.379-.526 0-.976.129-1.351.387a2.525 2.525 0 0 0-.86 1.008 3.06 3.06 0 0 0-.296 1.332v.789c0 .646.112 1.194.336 1.644.224.451.537.792.941 1.024.404.232.871.347 1.402.347.344 0 .657-.049.938-.148.281-.099.523-.249.726-.449.203-.201.36-.449.469-.746l1.359.375a2.847 2.847 0 0 1-.687 1.156 3.352 3.352 0 0 1-1.199.781c-.477.188-1.015.281-1.614.281ZM77.906 9.645v1.203h-4.515V9.645h4.515Zm-3.203-2.079h1.406v8.547c0 .391.08.676.239.856.159.179.423.269.793.269.088 0 .201-.01.339-.031.138-.021.265-.042.379-.062l.289 1.187a2.51 2.51 0 0 1-.496.117 3.944 3.944 0 0 1-.55.039c-.756 0-1.344-.199-1.766-.597-.422-.399-.633-.955-.633-1.668V7.566ZM79.281 12.762h5.109v1.297h-5.109zM86.742 9.645h1.414v9.359c.005.552-.088 1.026-.281 1.422a2.01 2.01 0 0 1-.859.906c-.381.208-.855.313-1.422.313h-.282v-1.297h.258c.407 0 .703-.116.891-.348.187-.232.281-.564.281-.996V9.645Zm.711-1.43a.96.96 0 0 1-.687-.274.87.87 0 0 1-.289-.656c0-.26.096-.48.289-.66a.97.97 0 0 1 .687-.27.98.98 0 0 1 .695.27c.193.18.289.4.289.66a.87.87 0 0 1-.289.656.971.971 0 0 1-.695.274ZM93.594 18.566c-.599 0-1.132-.087-1.598-.261a2.82 2.82 0 0 1-1.152-.778 2.72 2.72 0 0 1-.61-1.265l1.336-.321c.125.48.361.831.707 1.055.347.224.78.336 1.301.336.609 0 1.095-.13 1.457-.391.362-.26.543-.57.543-.929a.996.996 0 0 0-.316-.754c-.211-.201-.533-.35-.965-.449l-1.453-.344c-.792-.188-1.38-.478-1.766-.871-.385-.393-.578-.897-.578-1.512 0-.5.141-.941.422-1.324.281-.383.665-.682 1.152-.899.487-.216 1.041-.324 1.66-.324.599 0 1.108.09 1.528.27.419.179.76.427 1.023.742.263.315.46.678.59 1.09l-1.273.328a2.238 2.238 0 0 0-.598-.852c-.279-.255-.699-.383-1.262-.383-.521 0-.954.12-1.301.36-.346.239-.519.542-.519.906a.96.96 0 0 0 .351.777c.235.196.607.353 1.118.473l1.32.313c.792.187 1.378.477 1.758.871.38.393.57.889.57 1.488 0 .51-.144.965-.434 1.363-.289.399-.692.712-1.21.942-.519.229-1.119.343-1.801.343Z"
          style={{ fill: `${negative ? "#eee" :"#737373"}`, fillRule: "nonzero" }}
        />
        <path
          d="M14.869 7.592.367 13.813C-.011 14.916 0 15.952 0 16.905c.001 1.754.735 3.444 1.686 4.918l16.437-7.187c-.602-2.224-1.797-4.783-3.255-7.044h.001Z"
          style={{ fill: "#ccd3d8", fillRule: "nonzero" }}
        />
        <path
          d="m1.686 21.823.012.018a9.13 9.13 0 0 0 .959 1.235 11.468 11.468 0 0 0 .442.445 9.028 9.028 0 0 0 1.226.971c.087.057.175.112.264.166a7.361 7.361 0 0 0 .544.309c.093.048.187.094.282.139a7.21 7.21 0 0 0 .573.253 10.333 10.333 0 0 0 .587.211 11.35 11.35 0 0 0 .603.169 9.742 9.742 0 0 0 1.547.24c.103.007.207.012.311.015a8.274 8.274 0 0 0 .55.003c.105-.002.209-.006.314-.012.104-.007.208-.016.312-.027.104-.009.208-.02.312-.032a9.936 9.936 0 0 0 .923-.169 8.424 8.424 0 0 0 .899-.265 7.345 7.345 0 0 0 .585-.225 9.15 9.15 0 0 0 .843-.413c.091-.05.181-.101.271-.154a9.174 9.174 0 0 0 2.553-2.283 9.646 9.646 0 0 0 .362-.511c.058-.087.114-.175.169-.264a9.036 9.036 0 0 0 .306-.546c.049-.092.096-.186.142-.279.045-.095.089-.19.131-.285a11.675 11.675 0 0 0 .229-.582 8.636 8.636 0 0 0 .19-.597 9.597 9.597 0 0 0 .151-.608c.02-.102.039-.204.056-.306.019-.103.036-.206.051-.309a11.021 11.021 0 0 0 .086-1.25c0-.634-.169-1.535-.347-2.244L1.686 21.823Z"
          style={{ fill: "#aab6c1", fillRule: "nonzero" }}
        />
        <path
          d="M14.869 7.592c-.375-.597-.825-1.14-1.211-1.702C11.378 2.565 9.098 0 9.098 0S6.819 2.565 4.539 5.89c-1.14 1.662-2.28 3.515-3.135 5.332-.438.929-.787 1.711-1.037 2.591l14.502-6.221Z"
          style={{ fill: "#eaedf0", fillRule: "nonzero" }}
        />
      </g>
    </svg>
  );
};
